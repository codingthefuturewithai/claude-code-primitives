---
name: devflow-setup
description: Configure DevFlow backends for issue tracking, documentation, and VCS. Use this skill when the user wants to set up, configure, or reconfigure their DevFlow development workflow backends, or when another command/skill says to run setup.
user-invocable: true
allowed-tools:
  - Read
  - Write
  - Bash
  - Glob
  - AskUserQuestion
  - mcp__atlassian__getAccessibleAtlassianResources
  - mcp__gitlab__list_projects
  - mcp__google-drive__search_files
  - mcp__rag-memory-primary__list_collections
---

# DevFlow Setup

**Say exactly:** "SKILL INVOKED: setup"

## Critical Rules

- **Check first, ask later** — detect MCP access before asking configuration questions
- **Never guess or fabricate** MCP parameters (cloudId, project IDs, emails, etc.)
- **Always confirm** detected settings with user before storing
- Each reference file is **self-contained** — follow it completely

---

## Step 0: Check Existing Configuration

Check for an existing config file:

1. Check `~/.claude/plugins/config/devflow/config.md`

**If config exists**, tell the user:
> "You have an existing DevFlow configuration. Would you like to:"
> 1. Reconfigure from scratch
> 2. Keep current settings
> 3. View current settings

If "Keep" → end. If "View" → display config, then ask if they want to reconfigure.

---

## Step 1: Issue Tracking

Ask:
> "Do you want to use an issue tracker with DevFlow?"
> 1. Yes - Jira (Atlassian MCP)
> 2. Yes - GitLab Issues (GitLab MCP)
> 3. Yes - GitHub Issues (gh CLI)
> 4. No - Skip issue tracking

Route based on selection:
- **Jira** → follow [references/issues-jira.md](references/issues-jira.md)
- **GitLab** → follow [references/issues-gitlab.md](references/issues-gitlab.md)
- **GitHub** → follow [references/issues-github.md](references/issues-github.md)
- **Skip** → set `ISSUES_BACKEND=none`, `ISSUES_ENABLED=false`

Store results: `ISSUES_BACKEND`, `ISSUES_ENABLED`, `ATLASSIAN_VERIFIED` (bool), `CLOUD_ID` (if Jira)

---

## Step 2: Documentation System

Ask:
> "Do you want documentation integration?"
> 1. Yes - Confluence (Atlassian)
> 2. Yes - Google Drive
> 3. No - Skip documentation

Route based on selection:
- **Confluence:**
  - If `ATLASSIAN_VERIFIED=true` from Step 1: "Atlassian MCP already connected. Confluence is available."
    Ask for optional `default_space`, then continue.
  - If NOT verified → follow [references/docs-confluence.md](references/docs-confluence.md)
- **Google Drive** → follow [references/docs-google-drive.md](references/docs-google-drive.md)
- **Skip** → set `DOCS_BACKEND=none`, `DOCS_ENABLED=false`

---

## Step 3: RAG Memory

Ask:
> "Do you want RAG Memory for AI-retrievable knowledge?"
>
> RAG Memory stores knowledge that AI can search and retrieve — useful for technical documentation, project notes, and quick references.
>
> 1. Yes - Enable RAG Memory
> 2. No - Skip RAG Memory

Route based on selection:
- **Yes** → follow [references/rag-memory.md](references/rag-memory.md)
- **Skip** → set `RAG_ENABLED=false`

**If both docs AND RAG Memory enabled**, ask routing preference:
> "You have both a docs backend and RAG Memory. How should content be routed?"
> 1. Let me decide each time (default)
> 2. Quick notes → RAG, formal docs → [Confluence/Google Drive]
> 3. Everything to RAG Memory

---

## Step 4: VCS Configuration

VCS is determined by issue tracker choice:

- **GitLab Issues selected** → VCS = GitLab (MRs)
- **GitHub Issues selected** → VCS = GitHub (PRs)
- **Jira or none** → auto-detect from git remote:

```bash
git remote get-url origin 2>/dev/null
```

- Contains `github.com` → GitHub (PRs)
- Contains `gitlab` → GitLab (MRs)
- Other → default GitHub

Display:
> "VCS Backend: [GitHub PRs / GitLab MRs]"

---

## Step 5: Summary & Confirmation

Display a summary table of all settings:

```
DevFlow Configuration Summary
=============================

Issue Tracking:
  Backend: [jira/gitlab/github/none]
  Status: [enabled/disabled]

Documentation:
  Backend: [confluence/google-drive/none]
  Status: [enabled/disabled]
  Organization: [manual/default-folder/ask-each-time]

Knowledge Base (RAG Memory):
  Status: [enabled/disabled]
  Routing: [decide-each-time/quick-to-rag/all-to-rag]

Version Control:
  Backend: [github/gitlab]
  Auto-detected: [yes/no]
```

Ask:
> "Save this configuration?"
> 1. Yes - Save configuration
> 2. No - Cancel setup

---

## Step 6: Write Configuration

**First, create the config directory if it doesn't exist:**
```bash
mkdir -p ~/.claude/plugins/config/devflow
```

**Then write to `~/.claude/plugins/config/devflow/config.md`:**

```markdown
# DevFlow Backend Configuration
# Generated by /devflow-setup
# Regenerate anytime with: /devflow-setup

## Issue Tracking
backend: [jira/gitlab/github/none]
enabled: [true/false]
# For Jira:
cloudId: [if jira]
# For GitLab:
default_project: [if gitlab, optional]
# For GitHub:
# Uses current repo context via gh CLI

## Documentation
backend: [confluence/google-drive/none]
enabled: [true/false]
organization: [manual/default-folder/ask-each-time]
# For Google Drive with default-folder:
default_folder_id: [folder id]
# For Confluence:
default_space: [space key, optional]

## Knowledge Base (RAG Memory)
enabled: [true/false]
routing: [decide-each-time/quick-to-rag/all-to-rag]

## Version Control
backend: [github/gitlab]
# Auto-detected from git remote
```

---

## Complete

Say: "DevFlow configured! Your backends are ready."

### Discover Available Skills

1. Find the installed plugin location:
   ```bash
   # Find plugin cache path
   find ~/.claude/plugins/cache/claude-code-primitives -name "devflow" -type d 2>/dev/null | head -1
   ```
   Or if in source repo: `plugins/devflow`

2. List all skills in the plugin's `skills/` directory:
   ```bash
   ls "$PLUGIN_PATH/skills/"
   ```

3. For each skill, follow the symlink and read `SKILL.md` to extract:
   - **name** from frontmatter
   - **description** from frontmatter

4. Group skills by category prefix (build, pm, docs, rag-memory, devops) and present:

```
## Available Skills

### Build ([count] skills)
| Skill | Description |
|-------|-------------|
| `/devflow:build:fetch-issue` | description |

### PM ([count] skills)
...
```

5. End with:

> **Reconfigure anytime:** `/devflow-setup`
>
> **Full guide:** `/devflow:guide` to see all skills, hooks, and usage
>
> **If you enabled RAG Memory:** Run `/devflow:rag-memory:setup-collections` to create recommended collections
